<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive floor plan</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="ikr_container">
        <div class="unit-box" id="reserve_status">
            <div class="unit-title">Office Unit<br>202</div>
            <div class="unit-size">1,920 </div>
            <div class="unit-status">Available</div>
        </div>

        <div id="lease_popup" class="card">
            <h3>Office U202</h3>
            <p>950 sq ft.</p>
            <a href="#" class="lease-btn">Lease</a>
            <p class="leased">Leased</p>
            <p class="leased">Leased</p>
        </div>

        <div class="popup dark-popup ">
            <h3>Office Unit 400</h3>
            <p>500 sq ft</p>
            <a href="#" class="btn dark">Available</a>
        </div>


        <div class="popup light-popup" id="floor_datail_popup">
            <h3>Cell Phone Shop</h3>
            <p><strong>Square Footage</strong> &nbsp; 500</p>
            <p><strong>Rental Pricing</strong> &nbsp; 6.500/mo</p>
            <p><strong>Lease Status</strong> &nbsp; <span class="available">Available</span></p>
            <a href="#" class="btn light">Reserve This Unit</a>
            <div class="pointer"></div>
        </div>
        <div class="ikr_rv_detail" id="ikr_rv_detail">
            <div style="position: relative">
                <div id="detail_img" class="ikr_detail_img">
                    <img src="" alt="" id="map_img" />
                </div>
                <div class="map_details">
                    <p id="plotId" class="map_title"></p>

                    <div id="detail_des" class="detail_des"></div>

                    <a id="ikr_btnTxt" class="ikr_map_tooltip_button" target="_blank" href="">
                        Details</a>
                </div>
            </div>
        </div>
        <div class="ikr_map_tooltip" id="ikr_map_tooltip"></div>


        <svg id="ikr_svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
            viewBox="0 0 1024 1024">
            <defs>
                <style>
                    .cls-1 {
                        fill: #ff0d0d;

                        stroke-miterlimit: 10;
                        opacity: 0.01;
                    }
                </style>
            </defs>
            <g id="Layer_1" data-name="Layer 1">
                <image width="1024" height="1024" xlink:href="./svg/Solareign_East_GroundFloor-01.png" />
            </g>
            <g id="solareign_st_ground_floor">
                <polygon id="organic_market" class="cls-1"
                    points="553.28 616.09 554.04 505.53 660.77 506.55 657.19 277.28 553.28 275.23 553.28 207.83 401.87 207.83 408 64.85 112.34 64.85 48.68 781.28 412.94 781.28 419.75 617.19 553.28 616.09" />
                <polygon id="ezcvertor" class="cls-1"
                    points="103.66 814.47 117.96 882.38 360.51 882.38 354.72 814.47 103.66 814.47" />
                <polygon id="market_entry" class="cls-1"
                    points="427.4 882.38 550.47 882.38 554.55 628.6 429.45 628.6 424.34 794.04 427.4 882.38" />
                <polygon id="r1_entry" class="cls-1"
                    points="584.18 814.8 651.91 814.8 647.49 885.96 582.64 884.6 584.18 814.8" />
                <polygon id="r1" class="cls-1"
                    points="560.68 781.28 667.91 781.28 663.15 513.36 562.04 513.36 560.68 781.28" />
                <path id="salon_entry" class="cls-1"
                    d="M704.34,814.8H811.91L802.72,879H697.87ZM860.6,879h99.74L974,814.8l-100.09,1.54Z" />
                <polygon class="cls-1" id="salon"
                    points="672 563.23 842.04 563.23 854.3 781.28 677.11 781.28 672 563.23" />
                <polygon id="entry-2" data-name="entry" class="cls-1"
                    points="862.64 782.98 999.15 781.28 981.45 563.23 852.09 563.23 862.64 782.98" />
                <polygon id="salon_2" class="cls-1"
                    points="852.09 554.04 979.91 554.04 960.51 309.45 835.91 309.45 852.09 554.04" />
                <polygon id="cell_phone_2" class="cls-1"
                    points="672 554.04 841.53 554.04 827.23 309.45 664.34 309.45 672 554.04" />
                <polygon id="salon_1" class="cls-1"
                    points="835.91 302.3 959.49 302.3 940.6 64.85 824.17 64.85 835.91 302.3" />
                <polygon id="cell_phone" class="cls-1"
                    points="669.28 302.3 829.28 302.3 815.32 64.85 664.34 64.85 669.28 302.3" />
                <polygon id="elevor" class="cls-1"
                    points="565.45 64.85 654.98 64.85 659.06 199.83 565.45 201.53 565.45 64.85" />
                <polygon id="r2" class="cls-1"
                    points="417.19 64.85 554.55 64.85 554.55 201.53 412.08 201.53 417.19 64.85" />
                <polygon id="r2_entry" class="cls-1"
                    points="459.06 229.79 461.62 309.45 522.38 309.45 522.38 229.79 459.06 229.79" />
            </g>
        </svg>

    </div>

    <!-- import the data from the data js -->
    <script src="./data.js"></script>

    <script>
        const ikr_svg = document.getElementById('ikr_svg');
        const lease_popup = document.getElementById('lease_popup');
        const reserve_status = document.getElementById('reserve_status');
        const floor_datail_popup = document.getElementById('floor_datail_popup');
        const ikr_rv_detail = document.getElementById("ikr_rv_detail");
        const plotId = document.getElementById("plotId");
        const map_img = document.getElementById("map_img");
        const detail_des = document.getElementById("detail_des");
        const ikr_map_tooltip = document.getElementById("ikr_map_tooltip");

        const floor_id = [
            "organic_market",
            "ezcvertor",
            "market_entry",
            "r1_entry",
            "r1",
            "salon_entry",
            "entry-2",
            "salon_2",
            "cell_phone_2",
            "salon_1",
            "cell_phone",
            "elevor",
            "r2",
            "r2_entry",
            "salon"
        ];


        
        function getAllChildNodeIds(svgElement) {
            const childNodeIds = [];
            for (const childElement of svgElement.children) {
                if (childElement.id) {
                    childNodeIds.push(childElement.id);
                }
                childNodeIds.push(...getAllChildNodeIds(childElement));
            }
            return childNodeIds;
        }

        console.log(getAllChildNodeIds(ikr_svg));

        floor_id.forEach((i) => {
            const getPath = document.getElementById(`${i}`);
            function showfloorData(ev, mapContent, index) {
                const ct = ev.target;

                function set_tooltip_id() {
                    // Clear any existing classes from the target
                    ct.classList.remove("available_units", "hoverColor");

                    if (mapContent.status.toLowerCase() === "available" || mapContent.status.toLowerCase() == "available (hourly)") {
                        reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("available_units");
                        return reserve_status;
                    } else if (mapContent.status.toLowerCase() === "reserved") {
                        reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("leased_units");
                        return reserve_status;
                    } else if (mapContent.status.toLowerCase() === "leased") {
                         reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("leased_units");
                        return reserve_status;
                    }

                    else if (mapContent.status.toLowerCase() === "under contract") {
                         reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("under_contract");
                        return reserve_status;
                    }
                    else if (mapContent.status.toLowerCase() === "management use") {
                         reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("management_use");
                        return reserve_status;
                    }
                    else if (mapContent.status.toLowerCase() === "bookable spaces") {
                        reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("bookable_spaces");
                        return reserve_status;
                    }



                    else {
                        reserve_status.innerHTML = `
                                <div class="unit-title">${mapContent.unit}</div>
                                <div class="unit-size">${mapContent.size} </div>
                            `;
                        ct.classList.add("hoverColor");
                        return reserve_status;
                    }
                }

                const tooltip = set_tooltip_id();
                tooltip.style.display = "block";
                tooltip.style.top = ev.offsetY + "px";

                let screenWidth = window.innerWidth;
                let left;
                console.log('screenWidth:', screenWidth);
                console.log('ev.offsetX:', ev.offsetX);
                if (screenWidth < 350 && ev.offsetX < 150) {
                    left = ev.offsetX + tooltip.offsetWidth / 6 - 30;
console.log(350)

                } else if (screenWidth < 350 && ev.offsetX < 200) {
                    left = ev.offsetX - tooltip.offsetWidth - 30;
                    console.log(200)
                }
                
                else if (screenWidth < 500 && ev.offsetX > 170) {
                    left = ev.offsetX - tooltip.offsetWidth - 30;
                    console.log(-500)
                }
                else if (screenWidth < 500 && ev.offsetX < 170) {
                    left = ev.offsetX + 30 ;
                    console.log('screen 170' )
                }
                
                else if (screenWidth > 500  && ev.offsetX <200) {
                    console.log('last 500')
                    left = ev.offsetX + 30 ;
                } else if (screenWidth > 550){
                     left = ev.offsetX - tooltip.offsetWidth - 30;
                }
                
                else {
                    left = ev.offsetX; // Simplified: 30 - 30 cancels out
                }
                // Ensure tooltip doesn't go off-screen
                tooltip.style.left = Math.max(10, left) + "px";
            }


            if (isMobile()) {
              getPath.addEventListener("click", (ev) => {
                    let ct = ev.target;
                    floor_id.forEach((remove_color) => {
                        const removePath = document.getElementById(`${remove_color}`);
                        if (removePath) {
                            removePath.classList.remove("click_color");
                        }
                    });
                    ground_floor_data.map((mapContent) => {
                        if (mapContent.id == ct.parentNode.id || mapContent.id == ct.id) {
                            plotId.innerHTML = mapContent.unit;
                            ct.classList.add("click_color");
                            detail_des.innerHTML = `
              <p> ${mapContent.size} </p>
        
              <p>${mapContent.status}</p>
            `;
                     ikr_btnTxt.innerHTML = mapContent.btn_text || "Details";

            ikr_btnTxt.style.display = "block";
                            // if (mapContent.link =="" || mapContent.btn_text === "") {
                            if (mapContent.btn_text === "") {
                                ikr_btnTxt.style.display = "none";
                            } else {
                                ikr_btnTxt.style.display = "block";
                                ikr_btnTxt.href = mapContent.link;
                                       
                            }

                            ikr_rv_detail.style.display = "block";

                            const rect = ct.getBoundingClientRect();
                            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

                            const tooltipWidth = ikr_rv_detail.offsetWidth;
                            const tooltipHeight = ikr_rv_detail.offsetHeight;

                            const top = rect.bottom + scrollTop + 8;
                            let left = rect.left + scrollLeft + (rect.width / 2) - (tooltipWidth / 2);

                            const viewportWidth = window.innerWidth;
                            if (left + tooltipWidth > viewportWidth) {
                                left = viewportWidth - tooltipWidth - 10;
                            }
                            if (left < 0) {
                                left = 10;
                            }

                            ikr_rv_detail.style.top = `${top - tooltipHeight - 21}px`;
                            ikr_rv_detail.style.left = `${left}px`;
                        }
                    });
                });

           
           
            } else {
                // Click Event: open the tooltip on the bottom-center of the plot
                getPath.addEventListener("click", (ev) => {
                    let ct = ev.target;
                    floor_id.forEach((remove_color) => {
                        const removePath = document.getElementById(`${remove_color}`);
                        if (removePath) {
                            removePath.classList.remove("click_color");
                        }
                    });
                    ground_floor_data.map((mapContent) => {
                        if (mapContent.id == ct.parentNode.id || mapContent.id == ct.id) {
                            plotId.innerHTML = mapContent.unit;
                            ct.classList.add("click_color");
                            detail_des.innerHTML = `
              <p> ${mapContent.size} </p>
        
              <p>${mapContent.status}</p>
            `;
                     ikr_btnTxt.innerHTML = mapContent.btn_text || "Details";

            ikr_btnTxt.style.display = "block";
                            // if (mapContent.link =="" || mapContent.btn_text === "") {
                            if (mapContent.btn_text === "") {
                                ikr_btnTxt.style.display = "none";
                            } else {
                                ikr_btnTxt.style.display = "block";
                                ikr_btnTxt.href = mapContent.link;
                                       
                            }

                            ikr_rv_detail.style.display = "block";

                            const rect = ct.getBoundingClientRect();
                            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

                            const tooltipWidth = ikr_rv_detail.offsetWidth;
                            const tooltipHeight = ikr_rv_detail.offsetHeight;

                            const top = rect.bottom + scrollTop + 8;
                            let left = rect.left + scrollLeft + (rect.width / 2) - (tooltipWidth / 2);

                            const viewportWidth = window.innerWidth;
                            if (left + tooltipWidth > viewportWidth) {
                                left = viewportWidth - tooltipWidth - 10;
                            }
                            if (left < 0) {
                                left = 10;
                            }

                            ikr_rv_detail.style.top = `${top - tooltipHeight - 21}px`;
                            ikr_rv_detail.style.left = `${left}px`;
                        }
                    });
                });

                // Mousemove Event for Hover Effect
                getPath.addEventListener("mousemove", (ev) => {
                    let currentTarget = ev.target;
                    currentTarget.style.cursor = "pointer";


                    ground_floor_data.forEach((mapContent, index) => {
                        if (mapContent.id === currentTarget.parentNode.id || mapContent.id === currentTarget.id) {
                            // console.log(mapContent.id);
                            showfloorData(ev, mapContent, index);
                        }
                    });
                });

                // Mouseout Event
                getPath.addEventListener("mouseout", (ev) => {
                    ev.target.classList.remove("hoverColor");
                    ev.target.style.opacity = '0';
                    reserve_status.style.display = "none";
                    floor_datail_popup.style.display = "none";
                    lease_popup.style.display = "none";

                    ev.target.classList.remove("available_units", "leased_units", "under_contract", "management_use", "bookable_spaces");

                });
            }
        });

        // Add mouseleave event to SVG to ensure tooltips are hidden
        ikr_svg.addEventListener('mouseleave', () => {
            reserve_status.style.display = "none";
            floor_datail_popup.style.display = "none";
            lease_popup.style.display = "none";
            floor_id.forEach((id) => {
                const path = document.getElementById(id);
                if (path) {
                    path.classList.remove("hoverColor");
                    path.style.opacity = '0';
                }
            });
        });

        // Hide ikr_rv_detail when clicking outside SVG plots or mismatched plots
        window.addEventListener('click', (ev) => {
            const clickedId = ev.target.id || ev.target.parentNode.id;
            let isInsideTooltip = false;

            let target = ev.target;
            while (target) {
                if (target === ikr_rv_detail) {
                    isInsideTooltip = true;
                    break;
                }
                target = target.parentNode;
            }

            if (!isInsideTooltip && !floor_id.includes(clickedId)) {
                ikr_rv_detail.style.display = 'none';
            }
        });

        window.addEventListener("load", (ev) => { });

        function isMobile() {
            const regex = /Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;
            return regex.test(navigator.userAgent);
        }
    </script>
</body>

</html>
