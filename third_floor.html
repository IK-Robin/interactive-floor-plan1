<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive floor plan</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="ikr_container">
        <div class="unit-box" id="reserve_status">
            <div class="unit-title">Office Unit<br>202</div>
            <div class="unit-size">1,920 sq ft</div>
            <div class="unit-status">Available</div>
        </div>

        <div id="lease_popup" class="card">
            <h3>Office U202</h3>
            <p>950 sq ft.</p>
            <a href="#" class="lease-btn">Lease</a>
            <p class="leased">Leased</p>
            <p class="leased">Leased</p>
        </div>

        <div class="popup dark-popup ">
            <h3>Office Unit 400</h3>
            <p>500 sq ft</p>
            <a href="#" class="btn dark">Available</a>
        </div>


        <div class="popup light-popup" id="floor_datail_popup">
            <h3>Cell Phone Shop</h3>
            <p><strong>Square Footage</strong> &nbsp; 500</p>
            <p><strong>Rental Pricing</strong> &nbsp; 6.500/mo</p>
            <p><strong>Lease Status</strong> &nbsp; <span class="available">Available</span></p>
            <a href="#" class="btn light">Reserve This Unit</a>
            <div class="pointer"></div>
        </div>
        <div class="ikr_rv_detail" id="ikr_rv_detail">
            <div style="position: relative">
                <div id="detail_img" class="ikr_detail_img">
                    <img src="" alt="" id="map_img" />
                </div>
                <div class="map_details">
                    <p id="plotId" class="map_title"></p>

                    <div id="detail_des" class="detail_des"></div>

                    <a id="ikr_btnTxt" class="ikr_map_tooltip_button" target="_blank" href="">
                        Details</a>
                </div>
            </div>
        </div>
        <div class="ikr_map_tooltip" id="ikr_map_tooltip"></div>


        <!-- Generator: Adobe Illustrator 26.0.3, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->
        <svg id="ikr_svg" version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg"
            xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 1024 1536"
            style="enable-background:new 0 0 1024 1536;" xml:space="preserve">
            <style type="text/css">
                .st0 {
                    opacity: 1.000000e-02;
                    fill: #F40808;
                   
                    stroke-miterlimit: 10;
                    enable-background: new;
                }

                .st1 {
                    opacity: 1.000000e-02;
                    fill: #F40808;
                    enable-background: new;
                }
            </style>
            <g id="">

                <image style="overflow:visible;enable-background:new    ;" width="2134" height="3200"
                    xlink:href="./svg/Solareign_East_ThirdFloor-01.png"
                    transform="matrix(0.48 0 0 0.48 -0.1108 7.384704e-02)">
                </image>
            </g>
            <rect id="office_303_400sqft" x="43.9" y="896.6" class="st0" width="564.5" height="385.3" />
            <polygon id="office_303" class="st0" points="624.3,1281.9 976,1281 972.8,896.6 622,896.6 " />
            <polygon id="office302" class="st0" points="622,885.8 976,886.4 972.9,535.5 622,535.5 " />
            <polygon id="elevator" class="st0" points="413.4,886.4 610,886.4 609.5,535.5 413.4,535.5 " />
            <polygon id="office_300" class="st0" points="46.5,885.8 400.9,885.8 401.4,535.5 48.7,535.5 " />
            <polygon id="kitchenette" class="st0" points="694.2,58.9 971.2,58.9 973,365 694.2,366.3 " />
            <polygon id="womens" class="st1" points="567.2,290.7 683.9,290.7 681.4,58.9 567.2,58.9 " />
            <polygon id="elevator-2" class="st0" points="417.4,58.9 554.5,58.9 554.5,290.7 419.1,290.7 " />
            <polygon id="entry" class="st0" points="438.8,322.7 440.9,396.6 537.5,399 537.5,322.7 " />
            <polygon id="conference_room" class="st0" points="971.2,377.5 973,523.2 50,522 52.4,58.7 404.9,58.9 405.1,303 408.9,397.3 
	566.5,399 566.8,388.7 573.3,303 684.9,304 683.2,375.5 " />
            <rect id="hispreed_wifi" x="294.1" y="1436.6" class="st0" width="351.3" height="67.4" />
        </svg>

    </div>

    <!-- import the data from the data js -->
    <script src="./data.js"></script>

    <script>

        const ikr_svg = document.getElementById('ikr_svg');
        const lease_popup = document.getElementById('lease_popup');
        const reserve_status = document.getElementById('reserve_status');
        const floor_datail_popup = document.getElementById('floor_datail_popup');



        function getAllChildNodeIds(svgElement) {
            const childNodeIds = [];

            // Iterate through all child elements of the SVG
            for (const childElement of svgElement.children) {
                // Check if the child element has an ID attribute
                if (childElement.id) {
                    childNodeIds.push(childElement.id);
                }

                // Recursively process child elements
                childNodeIds.push(...getAllChildNodeIds(childElement));
            }

            return childNodeIds;
        }

        console.log(getAllChildNodeIds(ikr_svg));

        const floor_id = [

            "office_303_400sqft",
            "office_303",
            "office302",
            "elevator",
            "office_300",
            "kitchenette",
            "womens",
            "elevator-2",
            "entry",
            "conference_room",
            "hispreed_wifi"
        ]



        function getAllChildNodeIds(svgElement) {
            const childNodeIds = [];
            for (const childElement of svgElement.children) {
                if (childElement.id) {
                    childNodeIds.push(childElement.id);
                }
                childNodeIds.push(...getAllChildNodeIds(childElement));
            }
            return childNodeIds;
        }

        console.log(getAllChildNodeIds(ikr_svg));

        floor_id.forEach((i) => {
            const getPath = document.getElementById(`${i}`);
            function showfloorData(ev, mapContent, index) {
                const ct = ev.target;

                function set_tooltip_id() {
                    // Clear any existing classes from the target
                    ct.classList.remove("available_units", "hoverColor");

                    if (mapContent.status.toLowerCase() === "available" || mapContent.status.toLowerCase() == "available (hourly)") {
                        reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("available_units");
                        return reserve_status;
                    } else if (mapContent.status.toLowerCase() === "reserved") {
                        reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("leased_units");
                        return reserve_status;
                    } else if (mapContent.status.toLowerCase() === "leased") {
                        reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("leased_units");
                        return reserve_status;
                    }

                    else if (mapContent.status.toLowerCase() === "under contract") {
                        reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("under_contract");
                        return reserve_status;
                    }
                    else if (mapContent.status.toLowerCase() === "management use") {
                        reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("management_use");
                        return reserve_status;
                    }
                    else if (mapContent.status.toLowerCase() === "bookable spaces") {
                        reserve_status.innerHTML = `
                        <div class="unit-title">${mapContent.unit}</div>
                        <div class="unit-size">${mapContent.size} </div>
                        <div class="unit-status">${mapContent.btn_text}</div>
                    `;
                        ct.classList.add("bookable_spaces");
                        return reserve_status;
                    }



                    else {
                        reserve_status.innerHTML = `
                                <div class="unit-title">${mapContent.unit}</div>
                                <div class="unit-size">${mapContent.size} </div>
                            `;
                        ct.classList.add("hoverColor");
                        return reserve_status;
                    }
                }

                const tooltip = set_tooltip_id();
                tooltip.style.display = "block";
                tooltip.style.top = ev.offsetY + "px";

                let screenWidth = window.innerWidth;
                let left;
                console.log('screenWidth:', screenWidth);
                console.log('ev.offsetX:', ev.offsetX);
                if (screenWidth < 350 && ev.offsetX < 150) {
                    left = ev.offsetX + tooltip.offsetWidth / 6 - 30;
                    console.log(350)

                } else if (screenWidth < 350 && ev.offsetX < 200) {
                    left = ev.offsetX - tooltip.offsetWidth - 30;
                    console.log(200)
                }

                else if (screenWidth < 500 && ev.offsetX > 170) {
                    left = ev.offsetX - tooltip.offsetWidth - 30;
                    console.log(-500)
                }
                else if (screenWidth < 500 && ev.offsetX < 170) {
                    left = ev.offsetX + 30;
                    console.log('screen 170')
                }

                else if (screenWidth > 500 && ev.offsetX < 200) {
                    console.log('last 500')
                    left = ev.offsetX + 30;
                } else if (screenWidth > 550) {
                    left = ev.offsetX - tooltip.offsetWidth - 30;
                }

                else {
                    left = ev.offsetX; // Simplified: 30 - 30 cancels out
                }
                // Ensure tooltip doesn't go off-screen
                tooltip.style.left = Math.max(10, left) + "px";
            }


            if (isMobile()) {
                getPath.addEventListener("click", (ev) => {
                    let ct = ev.target;
                    floor_id.forEach((remove_color) => {
                        const removePath = document.getElementById(`${remove_color}`);
                        if (removePath) {
                            removePath.classList.remove("click_color");
                        }
                    });
                    third_floor_data.map((mapContent) => {
                        if (mapContent.id == ct.parentNode.id || mapContent.id == ct.id) {
                            plotId.innerHTML = mapContent.unit;
                            ct.classList.add("click_color");
                            detail_des.innerHTML = `
              <p> ${mapContent.size} </p>
        
              <p>${mapContent.status}</p>
            `;
                            ikr_btnTxt.innerHTML = mapContent.btn_text || "Details";

                            ikr_btnTxt.style.display = "block";
                            // if (mapContent.link =="" || mapContent.btn_text === "") {
                            if (mapContent.btn_text === "") {
                                ikr_btnTxt.style.display = "none";
                            } else {
                                ikr_btnTxt.style.display = "block";
                                ikr_btnTxt.href = mapContent.link;

                            }

                            ikr_rv_detail.style.display = "block";

                            const rect = ct.getBoundingClientRect();
                            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

                            const tooltipWidth = ikr_rv_detail.offsetWidth;
                            const tooltipHeight = ikr_rv_detail.offsetHeight;

                            const top = rect.bottom + scrollTop + 8;
                            let left = rect.left + scrollLeft + (rect.width / 2) - (tooltipWidth / 2);

                            const viewportWidth = window.innerWidth;
                            if (left + tooltipWidth > viewportWidth) {
                                left = viewportWidth - tooltipWidth - 10;
                            }
                            if (left < 0) {
                                left = 10;
                            }

                            ikr_rv_detail.style.top = `${top - tooltipHeight - 21}px`;
                            ikr_rv_detail.style.left = `${left}px`;
                        }
                    });
                });



            } else {
                // Click Event: open the tooltip on the bottom-center of the plot
                getPath.addEventListener("click", (ev) => {
                    let ct = ev.target;
                    floor_id.forEach((remove_color) => {
                        const removePath = document.getElementById(`${remove_color}`);
                        if (removePath) {
                            removePath.classList.remove("click_color");
                        }
                    });
                    third_floor_data.map((mapContent) => {
                        if (mapContent.id == ct.parentNode.id || mapContent.id == ct.id) {
                            plotId.innerHTML = mapContent.unit;
                            ct.classList.add("click_color");
                            detail_des.innerHTML = `
              <p> ${mapContent.size} </p>
        
              <p>${mapContent.status}</p>
            `;
                            ikr_btnTxt.innerHTML = mapContent.btn_text || "Details";

                            ikr_btnTxt.style.display = "block";
                            // if (mapContent.link =="" || mapContent.btn_text === "") {
                            if (mapContent.btn_text === "") {
                                ikr_btnTxt.style.display = "none";
                            } else {
                                ikr_btnTxt.style.display = "block";
                                ikr_btnTxt.href = mapContent.link;

                            }

                            ikr_rv_detail.style.display = "block";

                            const rect = ct.getBoundingClientRect();
                            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                            const scrollLeft = window.pageXOffset || document.documentElement.scrollLeft;

                            const tooltipWidth = ikr_rv_detail.offsetWidth;
                            const tooltipHeight = ikr_rv_detail.offsetHeight;

                            const top = rect.bottom + scrollTop + 8;
                            let left = rect.left + scrollLeft + (rect.width / 2) - (tooltipWidth / 2);

                            const viewportWidth = window.innerWidth;
                            if (left + tooltipWidth > viewportWidth) {
                                left = viewportWidth - tooltipWidth - 10;
                            }
                            if (left < 0) {
                                left = 10;
                            }

                            ikr_rv_detail.style.top = `${top - tooltipHeight - 21}px`;
                            ikr_rv_detail.style.left = `${left}px`;
                        }
                    });
                });

                // Mousemove Event for Hover Effect
                getPath.addEventListener("mousemove", (ev) => {
                    let currentTarget = ev.target;
                    currentTarget.style.cursor = "pointer";


                    third_floor_data.forEach((mapContent, index) => {
                        if (mapContent.id === currentTarget.parentNode.id || mapContent.id === currentTarget.id) {
                            // console.log(mapContent.id);
                            showfloorData(ev, mapContent, index);
                        }
                    });
                });

                // Mouseout Event
                getPath.addEventListener("mouseout", (ev) => {
                    ev.target.classList.remove("hoverColor");
                    ev.target.style.opacity = '0';
                    reserve_status.style.display = "none";
                    floor_datail_popup.style.display = "none";
                    lease_popup.style.display = "none";

                    ev.target.classList.remove("available_units", "leased_units", "under_contract", "management_use", "bookable_spaces");

                });
            }
        });

        // Add mouseleave event to SVG to ensure tooltips are hidden
        ikr_svg.addEventListener('mouseleave', () => {
            reserve_status.style.display = "none";
            floor_datail_popup.style.display = "none";
            lease_popup.style.display = "none";
            floor_id.forEach((id) => {
                const path = document.getElementById(id);
                if (path) {
                    path.classList.remove("hoverColor");
                    path.style.opacity = '0';
                }
            });
        });

        // Hide ikr_rv_detail when clicking outside SVG plots or mismatched plots
        window.addEventListener('click', (ev) => {
            const clickedId = ev.target.id || ev.target.parentNode.id;
            let isInsideTooltip = false;

            let target = ev.target;
            while (target) {
                if (target === ikr_rv_detail) {
                    isInsideTooltip = true;
                    break;
                }
                target = target.parentNode;
            }

            if (!isInsideTooltip && !floor_id.includes(clickedId)) {
                ikr_rv_detail.style.display = 'none';
            }
        });

        window.addEventListener("load", (ev) => { });

        function isMobile() {
            const regex = /Mobi|Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i;
            return regex.test(navigator.userAgent);
        }

    </script>
</body>

</html>
